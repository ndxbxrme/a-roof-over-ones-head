.main.container
  .panel
    form.form-inline(ng-submit='reload()')
      .col-sm-6(style='padding: 10px')
        .input-group(style='width:100%')
          input.form-control(type='text', ng-model='storage.area', placeholder='Areas, seperated by commas')
          .input-group-btn
            input.btn.btn-primary(type='submit', value='Search')
      .col-sm-6
        div(range-slider='', model-min='priceRange.min', model-max='priceRange.max', min='1', max='150', filter="rangeFilter:'Â£'", show-values='true')
  .col-sm-8
    .selected-image.text-center(ng-show='listings.selectedImage()', ng-click='listings.selectImage(undefined)')
      img(ng-src='{{listings.selectedImage()}}', title='Click to close')
      a.close-btn(href='') &times;
    ui-gmap-google-map(center='listings.map().center', zoom='listings.map().zoom', bounds='listings.map().bounds', ng-hide='listings.selectedImage()')
      ui-gmap-marker(idKey='listings.selectedListing().guid', coords='listings.selectedListing()', ng-if='listings.selectedListing()')
      ui-gmap-marker(ng-repeat="listing in listings.all() | unique:'guid' | inPriceRange:priceRange | filter:filter", idKey='listing.lister_url', coords='listing', icon='{url:listing.thumb_url}', options="{title:listing.title + ': ' + listing.price_formatted, class:'icon'}", click='selectListing(listing)', ng-if='!isHidden(listing)')
  .selected-property.scroller.col-sm-4(ng-nicescroll='', ng-show='listings.selectedListing()')
    h4.col-xs-12.no-margin {{ listings.selectedListing().title }} - &nbsp;
      a(ng-href='{{listings.selectedListing().lister_url}}', target='_Blank') Website
    .col-xs-12
      h5.pull-left {{ listings.selectedListing().price_formatted }}
      button.btn.btn-primary.pull-right.margin-bottom(ng-click='addToFavorites(listings.selectedListing())', ng-show='$root.currentUser && !isFavorite(listings.selectedListing())') Add to favorites
      button.btn.btn-disabled.pull-right.margin-bottom(ng-hide='$root.currentUser') Sign in to favorite
      h4.pull-right(ng-show='isFavorite(listings.selectedListing())')
        a(href='favorites') Favorite
    .listing.col-xs-6(ng-repeat='pic in listings.selectedListing().pics')
      img.thumbnail(ng-src='{{pic}}', style='height: 12rem; max-width: 100%', onerror="this.style.display='none'", ng-click="listings.selectImage(pic)")
  .col-sm-4.greyed-out(ng-hide='listings.selectedListing()')
    div(ng-show='listings.all().length>0')
      h4.col-xs-12.no-margin Click an image on the map
      h5.col-xs-12 and the selected property will show here
      .listing.col-xs-6(ng-repeat='pic in [1,2,3,4]')
        img.thumbnail(ng-src='http://placehold.it/160x123?text=Image', style='width: 100%')
    div(ng-hide="listings.all().length>0 || response.application_response_code==='202'")
      h4.col-xs-12.no-margin Search for an area to get started
      p.col-xs-12 Find and compare UK properites quickly and simply.
      p.col-xs-12 Enter a comma seperated list of the areas you are interested in then use the price slider above to narrow down the results.
      p.col-xs-12 Sign in to save favorites.
    div(ng-show="listings.response().application_response_code==='202'")
      h4.no-margin Area not found
      h5 Did you mean...?
      div(ng-repeat='location in listings.response().locations')
        h4 
          a(href='', ng-click='searchFor(location.place_name)') {{ location.long_title }}
  .col-sm-4
    h4.text-center(ng-show='listings.loading()') Loading properties...&nbsp;&nbsp;
      i.fa.fa-spinner.fa-spin
  .search-listings
    .row {{listings.all().length}}
      .col-sm-6.margin-bottom
        .btn-group(dropdown='', is-open='status.isopen')
          button.btn.btn-primary.dropdown-toggle(dropdown-toggle='', ng-show='listings.all().length>0') 
            span(ng-show="storage.sort==='price'") Cheapest first&nbsp;
            span(ng-show="storage.sort==='-price'") Most expensive first&nbsp;
            span(ng-show="storage.sort==='location_accuracy'") Relevance&nbsp;
            span.caret
          ul.dropdown-menu(role='menu')
            li 
              a(href='', ng-click="storage.sort='price'") Cheapest first
            li 
              a(href='', ng-click="storage.sort='-price'") Most expensive first
            li 
              a(href='', ng-click="storage.sort='location_accuracy'") Relevance
        .btn-group
          label.btn.btn-primary(ng-model='storage.listing_type', btn-radio="'buy'", ng-click='reload()') Buy
          label.btn.btn-primary(ng-model='storage.listing_type', btn-radio="'rent'", ng-click='reload()') Rent
          label.btn.btn-primary(ng-model='storage.listing_type', btn-radio="'share'", ng-click='reload()') Share
      .col-sm-6.margin-bottom
        input.form-control(type='text', ng-model='filter', placeholder='Search within results', ng-show='listings.all().length>0')
    .col-xs-12.panel.panel-default(ng-repeat="listing in listings.all() | unique:'guid' | inPriceRange:priceRange | filter:filter | orderBy:storage.sort", ng-hide='isHidden(listing)')
      a(name='{{ listing.guid }}')
      .col-sm-6
        h4
          a(href='', ng-click='listings.selectListingAndImage(listing, null)') {{ listing.title }}
        h5 {{ listing.summary }}
          a(ng-href='{{listing.lister_url}}', target='_Blank') Website
      .col-sm-6.text-right   
        h4 {{ listing.price_formatted }}
        .btn-group.pull-right(role='group', ng-hide='isFavorite(listing)')
          button.btn.btn-default.margin-bottom(ng-click='hide(listing)', ng-show='$root.currentUser', type='button') Hide
          button.btn.btn-primary.margin-bottom(ng-click='addToFavorites(listing)', ng-show='$root.currentUser', type='button') Add to favorites
        button.btn.btn-disabled.pull-right.margin-bottom(ng-hide='$root.currentUser', type='button') Sign in to favorite
        h4.pull-right(ng-show='isFavorite(listing)')
          a(href='favorites') Favorite
      .col-sm-12(style='clear:both')
        .listing.col-xs-6.col-sm-4.col-md-3.col-lg-2.text-center(ng-repeat='pic in listing.pics')
          img.thumbnail(ng-src='{{pic}}', style='height: 12rem; max-width: 100%', onerror="this.style.display='none'", ng-click='listings.selectListingAndImage(listing, pic)')
        .listing.col-sm-2
          img.thumbnail(ng-src='{{ listing.img_url }}', ng-hide='listing.pics.length>0' style='width: 100%', ng-click='listings.selectListingAndPic(listing, img_url)')